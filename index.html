<html>
  <head>
    <title>Stacks</title>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>
<nav id="bookmark">
  <button id="new-button">New</button>
  <div id="search-form">
    <input form="search-form" type="text" id="search-box" class="hidden" placeholder="Title/Name"></input>
    <button form="search-form" id="search-button" type="button" onclick="toggleSearch()">Search</button>
  </div>
  <button id="sort-button">Sort</button>
  <button id="filter-button">Filter</button>
  <button id="reset-button">Reset</button>
  <button id="delLib-button">Delete</button>
  <div id="books-number" class="stats"></div>
  <div id="read-number" class="stats"></div>
  <div id="empty">e</div>
</nav>
<form id="new-form" class="new-form form hidden">
  <label class="new-book-labels">Title: </label>
  <input form="new-form" type="text"></input>
  <label class="new-book-labels">Author Name: </label>
  <div id="author-name-div">
    <input form="new-form" type="text" id="name-input-first" placeholder="First Name"></input>
    <input form="new-form" type="text" id="name-input-last" placeholder="Last Name"></input>
  </div>
  <label class="new-book-labels">Pages: </label>
  <input form="new-form" type="number"></input>
  <label class="new-book-labels">Year: </label>
  <input form="new-form" type="number"></input>
  <div id="new-read-wrapper">
    <input form="new-form" type="checkbox" name="new-read" id="new-read"/>
    <label for="new-read" class="new-book-labels" id="new-read-label">Read</label>
    <button form="new-form" type="submit" id="add-button">Add</button>
    <button form="new-form" type="button" id="clear">Clear</button> 
  </div> 
</form>
<form id="sort-form" class="form hidden">
  <label for="sort-ascending"> 
    <input name="ascend-descend"
      id="sort-ascending"
      value="ascending"
      type="radio"
      checked/>Ascending
  </label>
  <label for="sort-descending"> 
    <input name="ascend-descend"
      id="sort-descending"
      value="descending"
      type="radio"
      />Descending
  </label>
  <div id="sort-by-heading">Sort By:</div>
  <label for="sort-by-title"> 
    <input name="category"
      id="sort-by-title"
      value="title"
      type="radio"
      />Title
  </label>  
  <label for="author-name-first"> 
    <input name="category"
      id="author-name-first"
      value="authorFirst"
      type="radio"
      />Author's First Name
  </label> 
  <label for="author-name-last"> 
    <input name="category"
      id="author-name-last"
      value="authorLast"
      type="radio"
      checked/>Author's Last Name
  </label> 
  <label for="sort-year"> 
    <input name="category"
      id="sort-year"
      value="year"
      type="radio"
      />Year
  </label>
  <label for="sort-pages"> 
    <input name="category"
      id="sort-pages"
      value="pages"
      type="radio"
      />Pages
  </label> 
  <label for="sort-id"> 
    <input name="category"
      id="sort-id"
      value="id"
      type="radio"
      />Book ID#
  </label>
  <button form="sort-form" type="button" id="sort-submit">Sort</button>
</form>
<form id="filter-form" class="form hidden">
  Filter By:
  <label for="filter-year"> 
    <input name="filter-by"
      id="filter-year"
      form="filter-form"
      value="year"
      type="radio"
      checked/>Year
  </label>
  <label for="filter-pages"> 
    <input name="filter-by"
      id="filter-pages"
      form="filter-form"
      value="pages"
      type="radio"
      />Pages
  </label>
  <p>Range between:</p>
  <div>
    <input form="filter-form" type="number" class="filter-number" id="filter-start"></input>and
    <input form="filter-form" type="number" class="filter-number" id="filter-end"></input>
  </div>
  <button form="filter-form" type="button" id="filter-submit">Filter</button>
</form>
<main id="main">
 
</main>
</html>
<style>
  @import url('https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@500&&family=Arvo&display=swap');
  body {
    margin: 0;
  }
/* BOOKMARK SECTION */
  nav {
    position: fixed;
    width: 11vw;
    height: auto;
    background-image: url("https://github.com/sinsofangels/stacks/blob/master/kissclipart-bookmark-clipart-bookmark-f9be247b5462a543.png?raw=true");
    background-size: 100% 100%;
    background-repeat: no-repeat;
    display: grid;
    grid-template-rows: repeat(7, auto) 9vw 6vw;
  }
  #empty {
    visibility: hidden;
  }
/* BOOKMARK BUTTONS */
  button {
    margin-bottom: 1vw;
    margin-left: 1.5vw;
    height: 3.5vw;
    width: 8vw;
    color: #380c96;
    background-color: rgba(0,0,0,0);
    border-style: outset;
    border-color: purple;
    border-radius: 4px;
    font-family: 'M PLUS Rounded 1c', sans-serif;
    font-size: 1.8vw;
    font-weight: bold;
    cursor: pointer;
  }
  button:active {
    color: rgba(0, 0, 0, 0);
    border-color: rgba(0, 0, 0, 0);
  }
  /* ADD BOOK */
  #new-button {
    margin-top: 2vw;
  }
    /* CREATE NEW BOOK FORM */
    form {
      background-color: ivory;
      height: 35vw;
      width: 30vw;
      margin-left: 35vw;
      margin-top: 5vw;
      padding: 3vw;
      z-index: 1;
      position: fixed;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      border-width: 1px;
      border-style: solid;
      border-color:rgb(51, 51, 51);
      border-radius: 5px;
      font-size: 2vw;
      font-family: 'M PLUS Rounded 1c', sans-serif;
    }
    #new-form > input {
      width: 25vw;
      height: 3vw;
      margin: 1vw;
    }
    #new-read-wrapper {
      display: flex;
      padding-top: 2vw;
    }
    #new-read {
      height: 2vw;
      width: 2vw;
    }
    form > button {
      color: black;
      margin-top: -0.2vw;
      font-weight: normal;
      border-color: rgb(139, 139, 139);
      border-width: 1.5px;
    }
    form > div > button {
      color: black;
      margin-top: -0.2vw;
      font-weight: normal;
      border-color: rgb(139, 139, 139);
      border-width: 1.5px;
    }
    input[type="number"] {
      border-color: black;
      border-width: 1px;
    }
    #author-name-div {
      display: flex;
      flex-direction: row;
    }
    #name-input-first {
      width: 11.5vw;
      height: 2.5vw;
      margin-right: 2vw;
      margin-top: 1vw;
    }
    #name-input-last {
      width: 11.5vw;
      height: 2.5vw;
      margin-bottom: 2vw;
      margin-top: 1vw;
    }
  /* SEARCH */
  input[type="text"] {
    margin-bottom: .2vw;
    margin-left: 1.5vw;
    height: 2.3vw;
    width: 8vw;
    border-color: black;
    border-width: 1px;
    background-color: rgba(255, 255, 255, 0.7);
    font-size: 1.6vw;
  }
  #search-form {
    margin-bottom: 0;
  }
  /* SORT */
  #sort-by-heading {
    margin-top: 2vw;
    font-weight: bold;
  }
  #sort-form > button {
    margin-top: 2vw;
  }
  /* FILTER */
  #filter-form {
    width: 22vw;
    height: 25vw;
  }
  #filter-form > div {
    display:inline-flex;
  }
 .filter-number {
    width:8vw;
    margin: 0 1vw 3vw 1vw;
  }
  .stats {
    width: min-content;
    font-size: 1.8vw;
    font-family: 'M PLUS Rounded 1c', sans-serif;
    font-weight: bold;
    color: #380c96;
    margin-left: 1.5vw;
  }
/* BOOKSHELF START */
  main {
    display: grid;
    grid-template-columns: 11.2vw 85vw 11.2vw;
  }
  .shelf {
    background-color: #663800;
    grid-column: 2 / 3;
    width: 85vw;
    display: grid;
    grid-auto-flow: column;
    grid-auto-rows: 30vw;
    border-style: solid;
    border-color: #8f4f00;
    border-width: 1vw;
    align-items: end;
    justify-content: start;
  }
  .empty {
    color:rgba(0, 0, 0, 0);
  }
  .book {
    background-color: lightseagreen;
    width: 4vw;
    height: max-content;
    max-height: 22vw;
    padding: 1vw .5vw 1vw .5vw;
    writing-mode: vertical-rl;
    text-orientation: mixed;
    font-family: 'Arvo', serif;
    font-size: 2vw;
    line-height: 2.2vw;
    border-radius: 4px;
    border: solid;
    border-width: 1px;
    border-color: gray;
    cursor: pointer;
    overflow:hidden;
  }
  .book-onclick {
    position: fixed;
    height: max-content;
    max-height: max-content;
    width: 30vw;
    word-wrap: break-word;
    left: 40vw;
    top: 10vw;
    z-index: 2;
    writing-mode: horizontal-tb;
    text-orientation: upright;
    font-size: 3vw;
    line-height: 4vw;
    text-align: center;
    visibility: visible;
    border-left-style: solid;
    cursor: default;
  }
  #force-empty-shelf {
    color: rgba(0, 0, 0, 0);
  }
  /* PICKED UP/"OPEN" BOOK */
  .year {
    line-height: 0px;
    font-size: 2.2vw;
  }
  .pages {
    font-size: 2.2vw;
  }
      /* READ? CHECKBOX */
  input[type="checkbox"] {
    height: 2vw;
    width: 2vw;
  }
  label[for=read] {
    font-size: 2.2vw;
  }
  .delete-button {
    border-color: rgb(51, 51, 51);
    border-width: 1.5px;
    width: 9vw;
    margin-left: 0;
    margin-top: 4vw;
    color: black;
  }
  .delete-button:active {
    border-color: rgb(51, 51, 51);
    color: black;
  }
  /* .close-button {
    border-color: rgb(51, 51, 51);
    border-width: 1.5px;
    width: 9vw;
    margin-left: 3vw;
    margin-top: 4vw;
    color: black;
  } */
  /* SEARCH RESULTS */
 .raised {
  align-self:flex-start;
 }
 /* HIDE */
  .hidden {
    visibility: hidden;
    position: fixed;
  }

  /* MEDIA QUERY */
@media screen and (max-width: 415px) {
  nav {
    background-image: none;
    background-color: #cea1e3;
    width: 100vw;
    height: 10vw;
    display: flex;
  }
  button {
    margin-top: 1.8vw;
    height: 6vw;
    width: min-content;
    font-size: 2.8vw;
  }
  #new-button {
    margin-top: 1.8vw;
  }
  #search-button {
    margin-top: 1.8vw;
    height: 6vw;
    width: min-content;
    font-size: 2.8vw;
    background-color: #cea1e3;
  }
  .delete-button {
    width: min-content;
  }
  input[type="text"] {
    margin-top: 1.8vw;
    height: 6vw;
    width: 17vw;
    font-size: 3.8vw;
  }

  #empty {
    position: fixed;
  }
  .stats {
    font-size: 2.3vw;
    margin-top: 1.3vw;
  }
  main {
    padding-top: 10vw;
    grid-template-columns: 0 100vw 0;
  }
  .shelf {
    width: 100vw;
    grid-auto-rows: 47vw;
  }
  .book {
    width: 8.4vw;
    max-height: 37vw;
    font-size: 3vw;
    font-weight: bold;
    line-height: 3.7vw;
  }
  .book-onclick {
    height: max-content;
    max-height: max-content;
    width: 50vw;
    left: 20vw;
    top: 20vw;
    font-size: 5vw;
    line-height: 5vw;
  }
  .year {
    font-size: 3vw;
  }
  .pages {
    font-size: 3vw;
  }
  form {
    height: max-content;
    width: 60vw;
    margin-left: 20vw;
    margin-top: 15vw;
    font-size: 4vw;
  }
  #new-form > input {
    width: 40vw;
    height: 5vw;
    margin: 1vw;
  }
  #name-input-first {
    width: 18.5vw;
    height: 5vw;
  }
  #name-input-last {
    width: 18.5vw;
    height: 5vw;
  }
  #new-read {
    height: 4vw;
    width: 4vw;
  }
  
  #filter-form {
    width: 40vw;
    height: max-content;
  }
  #filter-form > div {
    display:inline-flex;
  }
 .filter-number {
    width:12vw;
    margin: 0 1vw 3vw 1vw;
  }
  
  input[type="checkbox"] {
    height: 4vw;
    width: 4vw;
  }
}
</style>
<script>
let mainLibrary = []; 

//UNCOMMENT TO RESET LOAD COUNT
localStorage.removeItem("loadCount"); 

let booksNumber = document.getElementById("books-number");
let readCounter = 0; 
let readNumber = document.getElementById("read-number");
let bookClass = document.getElementsByClassName("book");
let checkboxes = document.querySelectorAll("input[name=read]"); 

 // SETTING MAIN LIBRARY TO LOCAL STORAGE LIBRARY OR CREATION OF STOCK LIBRARY
 if (!localStorage.getItem("loadCount")) localStorage.setItem("loadCount", "0"); 
let counter = parseInt(localStorage.getItem("loadCount")); 
if (localStorage.getItem("currentLibrary")) {
  let localStorageLibrary = JSON.parse(localStorage.getItem("currentLibrary")); 
    function setFromStorage() {
      mainLibrary = localStorageLibrary;
      counter++; //counter so the stock library only loads first time
      localStorage.setItem("loadCount", `${counter}`); 
    }
  setFromStorage();  
}
else {
  if (counter < 1) {
    const anubisGates = new bookMaker("The Anubis Gates", "Tim", "Powers", 387, 1997, "off");
    const colorOfMagic = new bookMaker("The Color of Magic", "Terry", "Pratchett", 228, 2005, "off");
    const storyOfStone = new bookMaker("The Story of the Stone", "Barry", "Hughart", 236, 1989, "off");
    const theHobbit = new bookMaker("The Hobbit", "JRR", "Tolkien", 310, 1937, "off");
    const cryptonomicon = new bookMaker("Cryptonomicon", "Neal", "Stephenson", 1129, 2002, "off");
    const graveyardBook = new bookMaker("The Graveyard Book", "Neil", "Gaiman", 307, 2008, "off");

    addBookToLibrary(anubisGates);
    addBookToLibrary(colorOfMagic);
    addBookToLibrary(theHobbit);
    addBookToLibrary(cryptonomicon);
    addBookToLibrary(graveyardBook);
    addBookToLibrary(storyOfStone);
    
    counter++;
    localStorage.setItem("loadCount", `${counter}`);
  }
}

booksNumber.textContent = `Books: ${mainLibrary.length}`;
for (let i in mainLibrary) {
  if (mainLibrary[i].read === "on") readCounter++; 
}
readNumber.textContent = `Read: ${readCounter}`;

//UPDATING LOCAL STORAGE
function setStorage() { 
  localStorage.setItem("currentLibrary", JSON.stringify(mainLibrary));
  localStorageLibrary = JSON.parse(localStorage.getItem("currentLibrary"));
}

// LIBRARY CREATION
  const bookMakerConst = bookMaker;
  function bookMaker(title, authorFirst, authorLast, pages, year, read) {
    // Short-circuiting property assignments.
    // If no value is supplied, it assigns the OR value.
    this.title       = title       || "Untitled";
    this.authorFirst = authorFirst || "John";
    this.authorLast  = authorLast  || "Doe";
    this.pages       = pages       || 0;
    this.year        = year        || 0;
    this.read        = read        || "off";
    this.color       = colorPicker();
    if (this.read === "on") {
      readCounter++;
      readNumber.textContent = `Read: ${readCounter}`;
    }
  }
  
  function addBookToLibrary(book) {
    if (mainLibrary.length === 0) {
      book.id = 0;
      console.log(book.title)
    }
    else book.id = mainLibrary.length;
    // book.id = mainLibrary[mainLibrary.length-1].id+1;
    mainLibrary.push(book);
    setStorage();
    booksNumber.textContent = `Books: ${mainLibrary.length}`;
  }

// COLOR PICKER
  function colorPicker() {
    let num = Math.floor(Math.random() * 10);
    let colorArray = ["#ff756b", "lightseagreen", "#6bceff", "#7375c7", "#ddc0fa", "#ac84ad", "#d8db93", "#a68b46", "#76deb2", "#8bb586"]
    for (let i in colorArray) {
      if (i == num) return colorArray[i];
    }
  }

//SETUP FUNCTIONS FOR MAKING BOOKS
  function createAppend(parent, newNode) {
    parent.appendChild(document.createElement(newNode));
  }
  function classAdd(element, ...classes) {
    element.classList.add(...classes);
  }
  function setID(element, idName) {
    element.id = idName;
  }
  function setText(element, text) {
    element.textContent = text
  }
  function setBookColor(element, color) {
    element.style.backgroundColor = `${color}`;
  }

//MAIN BOOKSHELF CREATION FUNCTION
  function render(library) {
    function createShelf(){
      main.appendChild(document.createElement("section"));
      main.lastChild.setAttribute("id", "currentShelf");
      main.lastChild.classList.add("shelf");
      let currentShelf = document.getElementById("currentShelf");
      currentShelf.appendChild(document.createElement("span")); //invisible item to force shelf to appear even when section is empty
      currentShelf.lastChild.setAttribute("id", "force-empty-shelf");
    }
    if (library.length === 0) createShelf();
    for (let i in library) {
      // SHELF CREATION - couldn't figure out how to get it to auto drop to next shelf with grid, so fixed width books, 15 every shelf
      if (window.screen.availWidth > 415) {
        if (i % 16 === 0) {
          if (document.getElementById("currentShelf")) {
            currentShelf.removeAttribute("id", "currentShelf");
          }
          createShelf();
        } 
      }
      if (window.screen.availWidth < 415) {
        if (i % 10 === 0) {
          if (document.getElementById("currentShelf")) {
            currentShelf.removeAttribute("id", "currentShelf");
          }
          createShelf();
        }
      }
      //RENDER BOOKS
      function bookMakerDOM(parent, newNode) {
        function createParentDiv(parent, newNode) {
          createAppend(parent, "div");
          classAdd(parent.lastChild, "book");
          setID(parent.lastChild, `book${i}`);
          document.getElementById(`book${i}`).addEventListener("click", selectBook);
          setText(parent.lastChild, `${library[i].title}`);
          setBookColor(parent.lastChild, `${library[i].color}`);
        }
        createParentDiv(parent, newNode);
        function addAuthorName(parent, newNode) {
          createAppend(parent, newNode);
          setText(parent.lastChild, `${library[i].authorFirst} ${library[i].authorLast}`);
          classAdd(parent.lastChild, "hidden");
        }
        addAuthorName(parent.lastChild, "p");
        function addYear(parent, newNode) {
          createAppend(parent, newNode);
          setText(parent.lastChild, `Year: ${library[i].year}`);
          classAdd(parent.lastChild, "hidden", "year");
        }
        addYear(parent.lastChild, "p");
        function addPages(parent, newNode) {
          createAppend(parent, newNode);
          setText(parent.lastChild, `Pages: ${library[i].pages}`);
          classAdd(parent.lastChild, "hidden", "pages");
        }
        addPages(parent.lastChild, "p");
        function createReadBox(parent, newNode) {
          createAppend(parent, newNode);
          classAdd(parent.lastChild, "hidden", "box-wrapper");
          function createInput(parent, newNode) {
            createAppend(parent, newNode);
            parent.lastChild.setAttribute("type", "checkbox");
            parent.lastChild.name = "read";
            parent.lastChild.id = `read${parseInt(i)}`;
            if (library[i].read === "on") {
              parent.lastChild.checked = true;
            }
            parent.lastChild.addEventListener("change", saveToLibrary);
            createAppend(parent, "label");
            parent.lastChild.setAttribute("for", `read${parseInt(i)}`);
            setText(parent.lastChild, "Read");
          }
          createInput(parent.lastChild, "input");
        }
        createReadBox(parent.lastChild, "div");
        function deleteButton(parent, newNode) {
          createAppend(parent, newNode);
          setText(parent.lastChild, "Delete");
          parent.lastChild.id = "delete-button";
          classAdd(parent.lastChild, "hidden", "delete-button");
        }
        deleteButton(parent.lastChild, "button");
        // function closeButton(parent, newNode) {
        //     createAppend(parent, newNode);
        //     setText(parent.lastChild, "Close");
        //     classAdd(parent.lastChild, "hidden", "close-button");
        // }
        // closeButton(parent.lastChild, "button");
      }
      bookMakerDOM(currentShelf, "div");
    }
  }
  render(mainLibrary);

//DELETE MAIN DOM
function deleteMainDOM() {
  let node = document.getElementById("main");
  while (node.hasChildNodes()) {
    node.removeChild(node.lastChild);
  } 
}

//REFRESH DOM
function refreshDOM(lib) {
  deleteMainDOM();
  if (document.getElementById("sort-ascending").checked === false) {
    let reverseLibrary = [...lib].reverse();
    render(reverseLibrary);
  }
  if (document.getElementById("sort-ascending").checked === true) {
    render(lib);
  }
}

//READ STATUS SAVE TO LIBRARY
  function saveToLibrary(e) {
    let id = parseInt(e.target.id.slice(4));
    if (e.target.checked === true) {
      mainLibrary[id].read = "on";
      readCounter++
      readNumber.textContent = `Read: ${readCounter}`;
    }
    if (e.target.checked === false) {
      mainLibrary[id].read = "off";
      readCounter--
      readNumber.textContent = `Read: ${readCounter}`;
    }
    setStorage();
  }

//SELECTING BOOK / EVENT LISTENER
  function selectBook(e) {
    let curTarg = e.currentTarget;
    let forms = document.getElementsByClassName("form");
    let children = curTarg.childNodes;
    if (e.target.type !== "checkbox") {
      if (e.target.id !== "delete-button") {
        for (let i = 0; i < forms.length; i++) {
          if (!forms[i].classList.contains("hidden")) return; //don't open book if a form is open
        }
        for (let i = 0; i < bookClass.length; i++) {
          if (bookClass[i].classList.contains("book-onclick")) {
            if (e.target === bookClass[i] || bookClass[i].contains(e.target)) return; // don't close book if clicking on already open book
          }
        }
        curTarg.classList.toggle("book-onclick"); // opens book
        for (let i in children) {
          if (children[i].classList) {
            children[i].classList.toggle("hidden"); 
          }
        }
      } //DELETE BOOK
      else {
        if (confirm('Are you sure you want to delete this book from the database?')) {
          let bookID = e.currentTarget.id.slice(4);
          curTarg.remove();
          for (let i in mainLibrary) {
            console.log(mainLibrary[i])
            if (mainLibrary[i].id == bookID) {
              if (mainLibrary[i].read === "on") {
                readCounter--;
                readNumber.textContent = `Read: ${readCounter}`;
              }
              mainLibrary.splice(i, 1);
              for (let i in mainLibrary) {
                mainLibrary[i].id = i;
              }
              setStorage();
              booksNumber.textContent = `Books: ${mainLibrary.length}`;
              deleteMainDOM();
              render(mainLibrary);
            }
          }
        }
      }
    }
  }

//*CLICK OUTSIDE FORM TO CLOSE*
window.onclick = function(e) {
  let forms = document.getElementsByClassName("form");
  for (let i = 0; i < forms.length; i++) {
    if (!forms[i].classList.contains("hidden")) {
      let formSplit = forms[i].id.split("-"); // "${operation}-form" to "${operation}-button" to exclude associated button
      let buttonID = `${formSplit[0]}-button`; 
      if (e.target !== forms[i] && !forms[i].contains(e.target) && 
        !e.target.matches(`#${buttonID}`)) {//exclude form itself && its children nodes && its associated button
          forms[i].classList.add("hidden");
      }
    }
  }
  for (let i = 0; i < bookClass.length; i++) {
    if (bookClass[i].classList.contains("book-onclick")) {
      if (e.target !== bookClass[i] && !bookClass[i].contains(e.target)) { //if click is not on open book or its child nodes
        bookClass[i].classList.toggle("book-onclick");
        let children = bookClass[i].childNodes;
        for (let i in children) {
          if (children[i].classList) {
            children[i].classList.toggle("hidden"); 
          }
        }
      }
    }
  }
}

//********BOOKMARK BUTTONS START*********
  //OPEN NEW BOOK FORM
document.getElementById("new-button").addEventListener("click", openNewBookForm);
  function openNewBookForm() {
    let bookForm = document.getElementById("new-form");
    bookForm.classList.toggle("hidden");
  }

  //ADD NEW BOOK
let addNewForm = document.getElementById("new-form");
addNewForm.addEventListener("submit", addNewBook);
function addNewBook(e){
  event.preventDefault();
  let title = document.getElementById("new-form").elements[0];
  let authorFirst = document.getElementById("new-form").elements[1];
  let authorLast = document.getElementById("new-form").elements[2];
  let pages = document.getElementById("new-form").elements[3];
  let year = document.getElementById("new-form").elements[4];
  let read = document.getElementById("new-form").elements[5];
  if (read.checked === true) {
    read.value = "on";
  }
  else read.value = "off";
  const newBook = new bookMaker(title.value, authorFirst.value, authorLast.value, pages.value, year.value, read.value);
  addBookToLibrary(newBook);
  deleteMainDOM();
  render(mainLibrary);
  addNewForm.classList.toggle("hidden");
  document.getElementById("filter-button").style.backgroundColor = "rgba(0,0,0,0)";
  function delayFunction() {
    setTimeout(function() {addNewForm.classList.toggle("hidden");}, 50);
  }
  delayFunction();
  addNewForm.reset();
}
  //CLEAR BUTTON
let clear = document.getElementById("clear");  
clear.addEventListener("click", clearForm);
function clearForm() {
  document.getElementById("new-form").reset();
}

//SEARCH
let searchForm = document.getElementById("search-form");
searchForm.addEventListener("input", search);
searchForm.addEventListener("submit", () => {event.preventDefault();});
function search(e){
  let searchQuery = document.getElementById("search-box").value;
  for (let i in mainLibrary) {
    let bookID = `book${mainLibrary[i].id}`;
    console.log(bookID)
    if (!searchQuery) {document.getElementById(`${bookID}`).classList.remove("raised");}
    else {
      if (mainLibrary[i].title.toLowerCase().indexOf(searchQuery.toLowerCase()) !== -1 || 
      mainLibrary[i].authorFirst.toLowerCase().indexOf(searchQuery.toLowerCase()) !== -1 ||
      mainLibrary[i].authorLast.toLowerCase().indexOf(searchQuery.toLowerCase()) !== -1) {
        document.getElementById(`${bookID}`).classList.add("raised");
      }
      if (mainLibrary[i].title.toLowerCase().indexOf(searchQuery.toLowerCase()) === -1 && 
      mainLibrary[i].authorFirst.toLowerCase().indexOf(searchQuery.toLowerCase()) === -1 &&
      mainLibrary[i].authorLast.toLowerCase().indexOf(searchQuery.toLowerCase()) === -1) {
        document.getElementById(`${bookID}`).classList.remove("raised");
      }
    }
  }
}
  //button move
function toggleSearch() {
  document.getElementById("search-box").classList.toggle("hidden");
  if (document.getElementById("search-button").textContent == "Search") {
    document.getElementById("search-button").textContent = "Close";

  }
  else document.getElementById("search-button").textContent = "Search";    
    document.getElementById("search-box").value = null;
    search();
}

// SORT
let sortForm = document.getElementById("sort-form");
document.getElementById("sort-button").addEventListener("click", () => {
  sortForm.classList.toggle("hidden");
});
document.getElementById("sort-submit").addEventListener("click", sort);
function sort() {
  document.getElementById("filter-button").style.backgroundColor = "rgba(0,0,0,0)";
  function sortByProp(prop = "id") {
    return function(a, b) {
      let varA = a[prop].toUpperCase(), varB = b[prop].toUpperCase();
      if (varA < varB) return -1;
      if (varA > varB) return 1;
      return 0;
    }
  }
  for (let i = 2; i < sortForm.length; i++) {
    if (sortForm[i].checked !== false) {
      switch (sortForm[i].value) {
        case "title":
              mainLibrary.sort(sortByProp('title'));
              refreshDOM(mainLibrary);
              break;
        case "authorFirst":
              mainLibrary.sort(sortByProp('authorFirst'));
              refreshDOM(mainLibrary);
              break;      
        case "authorLast":
              mainLibrary.sort(sortByProp('authorLast'));
              refreshDOM(mainLibrary);
              break;      
        case "pages":
              mainLibrary.sort((a, b) => a.pages - b.pages);
              refreshDOM(mainLibrary);
              break;     
        case "year":
              mainLibrary.sort((a, b) => a.year - b.year);
              refreshDOM(mainLibrary);
              break;   
        case "id":
              mainLibrary.sort((a, b) => a.id - b.id);  
              refreshDOM(mainLibrary);
              break;          
      }
    }
  }
}


//FILTER
let filterForm = document.getElementById("filter-form");
document.getElementById("filter-button").addEventListener("click", () => {
  filterForm.classList.toggle("hidden");
});
document.getElementById("filter-submit").addEventListener("click", openFilterForm);
function openFilterForm(e) {
  let min = document.getElementById("filter-start").value;
  if (!min) min = 0;
  let max = document.getElementById("filter-end").value;
  if (!max) max = Math.pow(10, 1000);
  function filter(prop) {
    // let tempLibrary = [];
    for (let i in mainLibrary) {
      let bookID = `book${mainLibrary[i].id}`;
      if (parseInt(mainLibrary[i][prop]) < min || parseInt(mainLibrary[i][prop]) > max) {
        console.log(mainLibrary[i])
        console.log( document.getElementById(`${bookID}`))
        document.getElementById(`${bookID}`).classList.add("hidden");
      }
      else document.getElementById(`${bookID}`).classList.remove("hidden");
    }  
  }
  if (document.getElementById("filter-year").checked === true) filter("year");
  if (document.getElementById("filter-pages").checked === true) filter("pages");
  document.getElementById("filter-button").style.backgroundColor = "#75ff78";
}

//RESET BUTTON 
document.getElementById("reset-button").addEventListener("click", reset);
function reset() {
  deleteMainDOM();
  mainLibrary.sort((a, b) => a.id - b.id);  
  render(mainLibrary);
  document.getElementById("filter-button").style.backgroundColor = "rgba(0,0,0,0)";
  for (let i = 0; i < bookClass.length; i++) {
    bookClass[i].addEventListener("click", selectBook);
  }
}

//DELETE LIBRARY
document.getElementById("delLib-button").addEventListener("click", deleteLibrary);
function deleteLibrary() {
  if (confirm('Are you sure you want to delete this book from the library?')) {
    localStorage.removeItem("currentLibrary");
    localStorageLibrary = [];
    deleteMainDOM();
    mainLibrary = [];
    readCounter = 0;
    readNumber.textContent = `Read: ${readCounter}`;
    booksNumber.textContent = `Books: ${mainLibrary.length}`;
    render(mainLibrary);
    document.getElementById("filter-button").style.backgroundColor = "rgba(0,0,0,0)";
  }
}

</script>